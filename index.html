<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Last War – Build Time Comparison by Endursa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:#0f172a;
      color:#e5e7eb;
    }
    body{ margin:0; display:flex; justify-content:center; }
    .container{ max-width:1100px; width:100%; padding:1.5rem; }
    h1{ font-size:1.6rem; margin-bottom:.5rem; }
    .subtitle{ color:#9ca3af; font-size:.9rem; margin-bottom:1rem; }

    .card{
      background:#020617;
      border-radius:1rem;
      padding:1.25rem;
      border:1px solid #1f2937;
      box-shadow:0 20px 40px rgba(0,0,0,.4);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
      gap:1rem;
    }

    label{ font-size:.8rem; color:#9ca3af; display:block; }
    input{
      width:100%;
      padding:.4rem .55rem;
      background:#020617;
      border:1px solid #374151;
      border-radius:.5rem;
      color:#e5e7eb;
      font-size:.85rem;
    }
    input:focus{
      outline:none;
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(34,197,94,.5);
    }
    input[disabled]{ opacity:.6; }

    .inline{ max-width:90px; }
    .row{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .title{
      font-weight:600;
      margin-bottom:.4rem;
      display:flex;
      align-items:center;
      gap:.5rem;
    }

    .results{
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
      margin:.75rem 0;
    }
    .pill{
      background:#071125;
      border:1px solid #263247;
      padding:.35rem .6rem;
      border-radius:.5rem;
      font-size:.85rem;
    }

    .recommend{
      margin:.5rem 0;
      color:#cbd5e1;
      font-size:.9rem;
    }
    .recommend strong{ color:#fef3c7; }

    .chart-wrap{
      position:relative;
      width:100%;
      height:40vh;
      min-height:300px;
      max-height:650px;
    }
    canvas{ width:100%!important; height:100%!important; }

    .error{ color:#f97373; font-size:.85rem; }

    @media(max-width:640px){
      h1{ font-size:1.25rem; }
      .chart-wrap{ height:50vh; }
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Last War – Build Time Comparison</h1>
  <p class="subtitle">
    Fixed reductions vs. percentage reduction (0.5% per helper).
    When Setup 2 is enabled, only the higher-helper setup competes against percent reduction.
  </p>

  <div class="card">

    <!-- Build time input -->
    <div class="title">Original build time</div>
    <div class="row">
      <div>
        <label>Days</label>
        <input id="inputDays" class="inline" type="number" min="0" value="2">
      </div>
      <div>
        <label>Hours</label>
        <input id="inputHours" class="inline" type="number" min="0" max="23" value="3">
      </div>
      <div>
        <label>Minutes</label>
        <input id="inputMinutes" class="inline" type="number" min="0" max="59" value="40">
      </div>
    </div>

    <div class="results">
      <div class="pill" id="resultFixed1">Setup 1: —</div>
      <div class="pill" id="resultFixed2">Setup 2: —</div>
      <div class="pill" id="resultPercent">Percent: —</div>
    </div>

    <div class="recommend" id="recommendUnder"><strong>Recommendation:</strong> —</div>

    <div class="grid">

      <!-- Setup 1 -->
      <div>
        <div class="title">Setup 1</div>
        <label>Helpers</label>
        <input id="fixedHelpers1" type="number" min="1" value="30">
        <div class="row">
          <div>
            <label>Minutes / helper</label>
            <input id="fixedMinutes1" class="inline" type="number" value="39">
          </div>
          <div>
            <label>Seconds / helper</label>
            <input id="fixedSeconds1" class="inline" type="number" value="12">
          </div>
        </div>
      </div>

      <!-- Setup 2 -->
      <div>
        <div class="title">
          Setup 2
          <label style="margin-left:auto;font-size:.8rem;">
            <input id="enableFixed2" type="checkbox"> enable
          </label>
        </div>
        <label>Helpers</label>
        <input id="fixedHelpers2" type="number" min="1" value="32" disabled>
        <div class="row">
          <div>
            <label>Minutes / helper</label>
            <input id="fixedMinutes2" class="inline" type="number" value="27" disabled>
          </div>
          <div>
            <label>Seconds / helper</label>
            <input id="fixedSeconds2" class="inline" type="number" value="36" disabled>
          </div>
        </div>
      </div>

      <!-- Percent -->
      <div>
        <div class="title">Percent reduction</div>
        <label>Helpers</label>
        <input id="percentHelpers" type="number" min="1" value="32">
        <div class="pill">0.5% per helper</div>
      </div>

    </div>

    <div class="recommend" id="breakEvenText"><strong>Break-even:</strong> —</div>
    <div class="error" id="errorText"></div>

    <div class="chart-wrap">
      <canvas id="chart"></canvas>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const FIXED_PERCENT_PER_HELPER = 0.5;
const DEFAULT_POINTS = 1000;
const DEFAULT_RANGE_DAYS = 10;

const el = id => document.getElementById(id);
let chart = null;

function formatTime(sec){
  sec = Math.max(0, Math.round(sec));
  const d = Math.floor(sec/86400);
  const h = Math.floor(sec%86400/3600);
  const m = Math.floor(sec%3600/60);
  return `${d}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m`;
}

function getInputSeconds(){
  return (
    (+el('inputDays').value||0)*86400 +
    (+el('inputHours').value||0)*3600 +
    (+el('inputMinutes').value||0)*60
  );
}

function updatePercentHelpers(){
  if (!el('enableFixed2').checked) return;
  el('percentHelpers').value = Math.max(
    +el('fixedHelpers1').value||1,
    +el('fixedHelpers2').value||1
  );
}

function generateData(){
  el('errorText').textContent = '';

  const h1 = +el('fixedHelpers1').value;
  const h2 = el('enableFixed2').checked ? +el('fixedHelpers2').value : 0;

  const r1 = h1 * ((+el('fixedMinutes1').value||0)*60 + (+el('fixedSeconds1').value||0));
  const r2 = h2 * ((+el('fixedMinutes2').value||0)*60 + (+el('fixedSeconds2').value||0));

  const pHelpers = +el('percentHelpers').value;
  if (!(h1>0 && pHelpers>0)) return null;

  const factor = Math.pow(1 - FIXED_PERCENT_PER_HELPER/100, pHelpers);

  let c1 = r1/(1-factor);
  let c2 = h2>0 ? r2/(1-factor) : null;

  if (h2>0){
    if (h1<h2) c1=null;
    if (h2<h1) c2=null;
  }

  const maxT = Math.max(
    c1?c1*1.5:0,
    c2?c2*1.5:0,
    DEFAULT_RANGE_DAYS*86400
  );

  const pts1=[], pts2=[], ptsP=[];
  for(let i=0;i<DEFAULT_POINTS;i++){
    const t=i*maxT/(DEFAULT_POINTS-1);
    pts1.push({x:t,y:Math.max(0,t-r1)});
    if(h2>0) pts2.push({x:t,y:Math.max(0,t-r2)});
    ptsP.push({x:t,y:t*factor});
  }

  return {pts1,pts2,ptsP,c1,c2,r1,r2,factor,h2};
}

function createChart(){
  updatePercentHelpers();
  const d = generateData();
  if(!d) return;

  const T = getInputSeconds();
  el('resultFixed1').textContent = `Setup 1: ${formatTime(Math.max(0,T-d.r1))}`;
  el('resultFixed2').textContent = d.h2
    ? `Setup 2: ${formatTime(Math.max(0,T-d.r2))}`
    : 'Setup 2: —';
  el('resultPercent').textContent =
    `Percent: ${formatTime(T*d.factor)}`;

  el('breakEvenText').innerHTML =
    `<strong>Break-even:</strong> ` +
    [d.c1&&`Setup 1 vs %: ${formatTime(d.c1)}`,
     d.c2&&`Setup 2 vs %: ${formatTime(d.c2)}`]
    .filter(Boolean).join(' | ') || '—';

  if(chart) chart.destroy();
  chart = new Chart(el('chart'),{
    type:'line',
    data:{
      datasets:[
        {label:'Setup 1',data:d.pts1,borderColor:'#f59e0b',borderWidth:2,pointRadius:0},
        d.h2&&{label:'Setup 2',data:d.pts2,borderColor:'#60a5fa',borderWidth:2,pointRadius:0},
        {label:'Percent (0.5%)',data:d.ptsP,borderColor:'#4ade80',borderDash:[6,4],borderWidth:2,pointRadius:0}
      ].filter(Boolean)
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      animation:false,
      scales:{
        x:{type:'linear',ticks:{callback:v=>formatTime(v)}},
        y:{ticks:{callback:v=>formatTime(v)}}
      }
    }
  });
}

el('enableFixed2').addEventListener('change',()=>{
  const en = el('enableFixed2').checked;
  ['fixedHelpers2','fixedMinutes2','fixedSeconds2'].forEach(id=>el(id).disabled=!en);
  el('percentHelpers').disabled = en;
  createChart();
});

document.querySelectorAll('input').forEach(i=>{
  i.addEventListener('input',createChart);
});

createChart();
</script>
</body>
</html>

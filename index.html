<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Last War – Build Time Comparison</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
}
body{ margin:0; display:flex; justify-content:center; }
.container{ max-width:1100px; width:100%; padding:1.5rem; }

h1{ font-size:1.6rem; margin-bottom:.5rem; }
.subtitle{ color:#9ca3af; font-size:.9rem; margin-bottom:1rem; }

.card{
  background:#020617;
  border-radius:1rem;
  padding:1.25rem;
  border:1px solid #1f2937;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:1rem;
}

label{ font-size:.8rem; color:#9ca3af; }
input{
  padding:.4rem .55rem;
  background:#020617;
  border:1px solid #374151;
  border-radius:.5rem;
  color:#e5e7eb;
  font-size:.85rem;
}
input[disabled]{ opacity:.6; }

.inline{ width:90px; text-align:center; }

.row{
  display:flex;
  gap:.5rem;
  align-items:flex-end;
  flex-wrap:wrap;
}

.title{
  font-weight:600;
  margin-bottom:.4rem;
  display:flex;
  align-items:center;
}

.results{
  display:flex;
  gap:1rem;
  flex-wrap:wrap;
  margin:.75rem 0;
}
.pill{
  background:#071125;
  border:1px solid #263247;
  padding:.35rem .6rem;
  border-radius:.5rem;
  font-size:.85rem;
}

.recommend{
  margin:.5rem 0;
  font-size:.9rem;
  color:#cbd5e1;
}
.recommend strong{ color:#fef3c7; }

.chart-wrap{
  position:relative;
  width:100%;
  height:40vh;
  min-height:300px;
  max-height:650px;
}
canvas{ width:100%!important; height:100%!important; }

.error{ color:#f97373; font-size:.85rem; }
</style>
</head>

<body>
<div class="container">
<h1>Last War – Build Time Comparison</h1>
<p class="subtitle">
Fixed reductions vs. percentage reduction (0.5% per helper).
</p>

<div class="card">

<!-- Build time -->
<div class="title">Original build time</div>
<div class="row">
  <div>
    <label>Days</label><br>
    <input id="inputDays" class="inline" type="number" min="0" value="2">
  </div>
  <div>
    <label>Hours</label><br>
    <input id="inputHours" class="inline" type="number" min="0" max="23" value="3">
  </div>
  <div>
    <label>Minutes</label><br>
    <input id="inputMinutes" class="inline" type="number" min="0" max="59" value="40">
  </div>
</div>

<div class="results">
  <div class="pill" id="resultFixed1">Setup 1: —</div>
  <div class="pill" id="resultFixed2">Setup 2: —</div>
  <div class="pill" id="resultPercent">Percent: —</div>
</div>

<div class="recommend" id="recommendText">
  <strong>Recommendation:</strong> —
</div>

<div class="grid">

<!-- Setup 1 -->
<div>
  <div class="title">Setup 1</div>
  <div class="row">
    <div>
      <label>Helpers</label><br>
      <input id="fixedHelpers1" class="inline" type="number" min="1" value="30">
    </div>
    <div>
      <label>Min / helper</label><br>
      <input id="fixedMinutes1" class="inline" type="number" value="39">
    </div>
    <div>
      <label>Sec / helper</label><br>
      <input id="fixedSeconds1" class="inline" type="number" value="12">
    </div>
  </div>
</div>

<!-- Setup 2 -->
<div>
  <div class="title">
    Setup 2
    <label style="margin-left:auto;font-size:.8rem;">
      <input id="enableFixed2" type="checkbox"> enable
    </label>
  </div>
  <div class="row">
    <div>
      <label>Helpers</label><br>
      <input id="fixedHelpers2" class="inline" type="number" min="1" value="32" disabled>
    </div>
    <div>
      <label>Min / helper</label><br>
      <input id="fixedMinutes2" class="inline" type="number" value="27" disabled>
    </div>
    <div>
      <label>Sec / helper</label><br>
      <input id="fixedSeconds2" class="inline" type="number" value="36" disabled>
    </div>
  </div>
</div>

<!-- Percent -->
<div>
  <div class="title">Percent reduction</div>
  <div class="row">
    <div>
      <label>Helpers</label><br>
      <input id="percentHelpers" class="inline" type="number" min="1" value="32">
    </div>
    <div class="pill">0.5% / helper</div>
  </div>
</div>

</div>

<div class="recommend" id="breakEvenText">
  <strong>Break-even:</strong> —
</div>

<div class="error" id="errorText"></div>

<div class="chart-wrap">
  <canvas id="chart"></canvas>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const FIXED_PERCENT = 0.5;
const POINTS = 800;
let chart;

const el = id => document.getElementById(id);

function formatTime(s){
  s=Math.max(0,Math.round(s));
  const d=Math.floor(s/86400);
  const h=Math.floor(s%86400/3600);
  const m=Math.floor(s%3600/60);
  return `${d}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m`;
}

function T(){ return (+el('inputDays').value||0)*86400+(+el('inputHours').value||0)*3600+(+el('inputMinutes').value||0)*60; }

function updatePercentHelpers(){
  if(!el('enableFixed2').checked) return;
  el('percentHelpers').value=Math.max(+el('fixedHelpers1').value||1,+el('fixedHelpers2').value||1);
}

function decideRecommendation(Ts,c1,c2,h1,h2){
  if(!el('enableFixed2').checked){
    return Ts<(c1||Infinity)?"Setup 1":"Percent reduction";
  }
  if(c1 && Ts<c1) return "Setup 1";
  if(c2 && Ts<c2) return "Setup 2";
  return "Percent reduction";
}

function createChart(){
  updatePercentHelpers();

  const h1=+el('fixedHelpers1').value;
  const h2=el('enableFixed2').checked?+el('fixedHelpers2').value:0;

  const r1=h1*((+el('fixedMinutes1').value||0)*60+(+el('fixedSeconds1').value||0));
  const r2=h2*((+el('fixedMinutes2').value||0)*60+(+el('fixedSeconds2').value||0));

  const pH=+el('percentHelpers').value;
  const factor=Math.pow(1-FIXED_PERCENT/100,pH);

  let c1=r1/(1-factor);
  let c2=h2?r2/(1-factor):null;

  if(h2){
    if(h1<h2) c1=null;
    if(h2<h1) c2=null;
  }

  const Tmax=Math.max((c1||0)*1.5,(c2||0)*1.5,864000);
  const d1=[],d2=[],dp=[];

  for(let i=0;i<POINTS;i++){
    const t=i*Tmax/(POINTS-1);
    d1.push({x:t,y:Math.max(0,t-r1)});
    if(h2) d2.push({x:t,y:Math.max(0,t-r2)});
    dp.push({x:t,y:t*factor});
  }

  const Ts=T();
  el('resultFixed1').textContent=`Setup 1: ${formatTime(Math.max(0,Ts-r1))}`;
  el('resultFixed2').textContent=h2?`Setup 2: ${formatTime(Math.max(0,Ts-r2))}`:"Setup 2: —";
  el('resultPercent').textContent=`Percent: ${formatTime(Ts*factor)}`;

  el('recommendText').innerHTML=`<strong>Recommendation:</strong> ${decideRecommendation(Ts,c1,c2,h1,h2)}`;

  el('breakEvenText').innerHTML=
    `<strong>Break-even:</strong> `+
    [
      c1&&`Setup 1 vs % (${pH} helpers): ${formatTime(c1)}`,
      c2&&`Setup 2 vs % (${pH} helpers): ${formatTime(c2)}`
    ].filter(Boolean).join(" | ") || "—";

  if(chart) chart.destroy();
  chart=new Chart(el('chart'),{
    type:'line',
    data:{datasets:[
      {label:'Setup 1',data:d1,borderColor:'#f59e0b',borderWidth:2,pointRadius:0},
      h2&&{label:'Setup 2',data:d2,borderColor:'#60a5fa',borderWidth:2,pointRadius:0},
      {label:`Percent (${pH} helpers)`,data:dp,borderColor:'#4ade80',borderDash:[6,4],borderWidth:2,pointRadius:0}
    ].filter(Boolean)},
    options:{responsive:true,maintainAspectRatio:false,animation:false,
      scales:{x:{type:'linear',ticks:{callback:v=>formatTime(v)}},
              y:{ticks:{callback:v=>formatTime(v)}}}}
  );
}

el('enableFixed2').addEventListener('change',()=>{
  const en=el('enableFixed2').checked;
  ['fixedHelpers2','fixedMinutes2','fixedSeconds2'].forEach(id=>el(id).disabled=!en);
  el('percentHelpers').disabled=en;
  createChart();
});

document.querySelectorAll('input').forEach(i=>i.addEventListener('input',createChart));
createChart();
</script>
</body>
</html>

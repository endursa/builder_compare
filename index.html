<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Last War – Build Time Comparison</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body{
  font-family: system-ui, Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  margin:0;
  display:flex;
  justify-content:center;
}
.container{ max-width:1100px; width:100%; padding:1.5rem; }
.card{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:1rem;
  padding:1.25rem;
}
.row{ display:flex; gap:.3rem; flex-wrap:wrap; align-items:flex-end; }
.inline{ width:90px; text-align:center; }
label{ font-size:.8rem; color:#9ca3af; }
input{
  padding:.4rem .1rem;
  background:#020617;
  border:1px solid #374151;
  border-radius:.5rem;
  color:#e5e7eb;
}
input[disabled]{ opacity:.6; }

.results{
  display:flex;
  gap:1rem;
  flex-wrap:wrap;
  margin:.75rem 0;
}
.pill{
  background:#071125;
  border:1px solid #263247;
  padding:.35rem .6rem;
  border-radius:.5rem;
  font-size:.85rem;
}
.fastest{
  border-color:#22c55e;
  color:#bbf7d0;
  box-shadow:0 0 0 1px rgba(34,197,94,.6);
}

.recommend{
  margin:.4rem 0;
  font-size:.9rem;
  color:#cbd5e1;
}
.recommend strong{ color:#fef3c7; }

.chart-wrap{ height:420px; margin-top:1rem; }
canvas{ width:100%!important; height:100%!important; }
</style>
</head>

<body>
<div class="container">
<div class="card">

<h2>Last War – Build Time Comparison by Endursa</h2>

<!-- Original build time -->
<div class="row">
 Initial build time:
</div>
  
<div class="row">
  <div><label>Days</label><br><input id="d" class="inline" type="number" value="2"></div>
  <div><label>Hours</label><br><input id="h" class="inline" type="number" value="3"></div>
  <div><label>Minutes</label><br><input id="m" class="inline" type="number" value="40"></div>
</div>

<div class="row">
  &nbsp
</div>
  
<div class="row">
 Reduced build times:
</div>
  
<div class="results">
  <div class="pill" id="res1">Setup 1: —</div>
  <div class="pill" id="resp">Percent: —</div>
  <div class="pill" id="res2">Setup 2: —</div>
</div>

<div class="recommend" id="recommend">
  <strong>Recommendation:</strong> —
</div>

<div class="recommend" id="breakeven">
  <strong>Break-even (max. time reduction vs. max. helpers):</strong> —
</div>
  
<hr>

<!-- Setup 1 -->
<div class="row">
  Setup 1 (max time purple or gold survivors)
</div>
  
<div class="row">
  <div><label>Helpers</label><br><input id="h1" class="inline" type="number" value="36"></div>
  <div><label>Min/helper</label><br><input id="m1" class="inline" type="number" value="48"></div>
  <div><label>Sec/helper</label><br><input id="s1" class="inline" type="number" value="54"></div>
</div>

<!-- Percent -->
<div class="row">
  <div><label>Max. number of helpers (all gold survivors)</label><br><input id="ph" class="inline" type="number" value="38"></div>
</div>

<div class="row">
  &nbsp
</div>
<!-- Setup 2 -->
<div class="row">
  Setup 2 (all gold survivors, max. helps)  
  <label><input id="enable2" type="checkbox"> Enable setup 2</label>
</div>

<div class="row">
  <div><label>Helpers</label><br><input id="h2" class="inline" type="number" value="38" disabled></div>
  <div><label>Min/helper</label><br><input id="m2" class="inline" type="number" value="33" disabled></div>
  <div><label>Sec/helper</label><br><input id="s2" class="inline" type="number" value="42" disabled></div>
</div>

<div class="chart-wrap">
  <canvas id="chart"></canvas>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const FIXED_PERCENT = 0.5;
let chart;

const $ = id => document.getElementById(id);

function formatTime(sec){
  sec = Math.max(0, Math.round(sec));
  const d = Math.floor(sec / 86400);
  const h = Math.floor((sec % 86400) / 3600);
  const m = Math.floor((sec % 3600) / 60);
  return `${d}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m`;
}

function originalSeconds(){
  return (+$('d').value||0)*86400 +
         (+$('h').value||0)*3600 +
         (+$('m').value||0)*60;
}

function normalize(){
  if ($('enable2').checked) {
    $('h2').disabled = $('m2').disabled = $('s2').disabled = false;
    $('ph').disabled = true;
    $('ph').value = Math.max(+$('h1').value, +$('h2').value);
  } else {
    $('h2').disabled = $('m2').disabled = $('s2').disabled = true;
    $('ph').disabled = false;
  }
}

function recalc(){
  normalize();

  const T = originalSeconds();

  const h1 = +$('h1').value;
  const h2 = $('enable2').checked ? +$('h2').value : 0;

  const per1 = (+$('m1').value||0)*60 + (+$('s1').value||0);
  const per2 = (+$('m2').value||0)*60 + (+$('s2').value||0);

  const r1 = h1 * per1;
  const r2 = h2 * per2;

  const ph = +$('ph').value;
  const factor = Math.pow(1 - FIXED_PERCENT/100, ph);

  const t1 = Math.max(0, T - r1);
  const t2 = h2 ? Math.max(0, T - r2) : null;
  const tp = T * factor;

  $('res1').textContent = `Setup 1: ${formatTime(t1)}`;
  $('res2').textContent = h2 ? `Setup 2: ${formatTime(t2)}` : 'Setup 2: —';
  $('resp').textContent = `Percent (${ph} helpers): ${formatTime(tp)}`;

  const options = [
    {id:'res1', label:'Setup 1', val:t1},
    h2 && {id:'res2', label:'Setup 2', val:t2},
    {id:'resp', label:'use max helpers setup', val:tp}
  ].filter(Boolean);

  const best = options.reduce((a,b)=>a.val<b.val?a:b);
  options.forEach(o=>$(o.id).classList.toggle('fastest', o===best));

  $('recommend').innerHTML =
    `<strong>Recommendation:</strong> ${best.label}`;

  let strongestPer = per1;
  let strongestHelpers = h1;
  let strongestLabel = 'Setup 1';
  
  if (h2 && per2 > per1) {
    strongestPer = per2;
    strongestHelpers = h2;
    strongestLabel = 'Setup 2';
  }
  
  const strongestTotalReduction = strongestPer * strongestHelpers;
  const be = strongestTotalReduction / (1 - factor);

  $('breakeven').innerHTML =
    `<strong>Break-even (max. time reduction vs. max. helpers):</strong> ${strongestLabel} vs % (${ph} helpers): ${formatTime(be)}`;

  const Tmax = Math.max(be*1.5, 864000);
  const d1=[], d2=[], dp=[];
  for (let i=0;i<600;i++){
    const t=i*Tmax/599;
    d1.push({x:t,y:Math.max(0,t-r1)});
    if (h2) d2.push({x:t,y:Math.max(0,t-r2)});
    dp.push({x:t,y:t*factor});
  }

  if (chart) chart.destroy();
  chart = new Chart($('chart'), {
    type:'line',
    data:{datasets:[
      {label:'Setup 1',data:d1,borderColor:'#f59e0b',pointRadius:0},
      h2 && {label:'Setup 2',data:d2,borderColor:'#60a5fa',pointRadius:0},
      {label:`Percent (${ph} helpers)`,data:dp,borderColor:'#4ade80',borderDash:[6,4],pointRadius:0}
    ].filter(Boolean)},
    options:{
      responsive:true,
      maintainAspectRatio:false,
      animation:false,
      scales:{
        x:{
          type:'linear',
          title:{display:true,text:'Original build time'},
          ticks:{callback:v=>formatTime(v)}
        },
        y:{
          title:{display:true,text:'Reduced build time'},
          ticks:{callback:v=>formatTime(v)}
        }
      },
      plugins:{
        tooltip:{
          callbacks:{
            title: items => `Original: ${formatTime(items[0].parsed.x)}`,
            label: ctx => `${ctx.dataset.label}: ${formatTime(ctx.parsed.y)}`
          }
        }
      }
    }
  });
}

$('enable2').addEventListener('change',recalc);
document.querySelectorAll('input').forEach(i=>i.addEventListener('input',recalc));
recalc();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Last War – Build Time Comparison</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
}
body{ margin:0; display:flex; justify-content:center; }
.container{ max-width:1100px; width:100%; padding:1.5rem; }

.card{
  background:#020617;
  border-radius:1rem;
  padding:1.25rem;
  border:1px solid #1f2937;
}

.row{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:flex-end; }
.inline{ width:90px; text-align:center; }

label{ font-size:.8rem; color:#9ca3af; }
input{
  padding:.4rem .55rem;
  background:#020617;
  border:1px solid #374151;
  border-radius:.5rem;
  color:#e5e7eb;
}
input[disabled]{ opacity:.6; }

.chart-wrap{
  position:relative;
  width:100%;
  height:420px;
}
canvas{ width:100%!important; height:100%!important; }

.pill{
  background:#071125;
  border:1px solid #263247;
  padding:.35rem .6rem;
  border-radius:.5rem;
  font-size:.85rem;
}
</style>
</head>

<body>
<div class="container">
<div class="card">

<h2>Last War – Build Time Comparison</h2>

<div class="row">
  <div><label>Days</label><br><input id="d" class="inline" type="number" value="2"></div>
  <div><label>Hours</label><br><input id="h" class="inline" type="number" value="3"></div>
  <div><label>Minutes</label><br><input id="m" class="inline" type="number" value="40"></div>
</div>

<hr>

<div class="row">
  <div><label>Setup 1 helpers</label><br><input id="h1" class="inline" type="number" value="30"></div>
  <div><label>Min/helper</label><br><input id="m1" class="inline" type="number" value="39"></div>
  <div><label>Sec/helper</label><br><input id="s1" class="inline" type="number" value="12"></div>
</div>

<div class="row">
  <label><input id="enable2" type="checkbox"> Enable setup 2</label>
</div>

<div class="row">
  <div><label>Setup 2 helpers</label><br><input id="h2" class="inline" type="number" value="32" disabled></div>
  <div><label>Min/helper</label><br><input id="m2" class="inline" type="number" value="27" disabled></div>
  <div><label>Sec/helper</label><br><input id="s2" class="inline" type="number" value="36" disabled></div>
</div>

<div class="row">
  <div><label>% helpers</label><br><input id="ph" class="inline" type="number" value="32"></div>
  <div class="pill">0.5% / helper</div>
</div>

<hr>

<div class="chart-wrap">
  <canvas id="chart"></canvas>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ✅ THE ONLY CORRECT REGISTRATION FOR CDN */
Chart.register(...Chart.registerables);

const FIXED_PERCENT = 0.5;
let chart;

const $ = id => document.getElementById(id);

function sec(){
  return (+$('d').value||0)*86400 + (+$('h').value||0)*3600 + (+$('m').value||0)*60;
}

function normalize(){
  if($('enable2').checked){
    $('h2').disabled=false;
    $('m2').disabled=false;
    $('s2').disabled=false;
    $('ph').disabled=true;
    $('ph').value=Math.max(+$('h1').value, +$('h2').value);
  }else{
    $('h2').disabled=true;
    $('m2').disabled=true;
    $('s2').disabled=true;
    $('ph').disabled=false;
  }
}

function draw(){
  normalize();

  const h1=+$('h1').value;
  const h2=$('enable2').checked?+$('h2').value:0;

  const r1=h1*((+$('m1').value||0)*60+(+$('s1').value||0));
  const r2=h2*((+$('m2').value||0)*60+(+$('s2').value||0));

  const ph=+$('ph').value;
  const factor=Math.pow(1-FIXED_PERCENT/100, ph);

  let c1=r1/(1-factor);
  let c2=h2?r2/(1-factor):null;

  if(h2){
    if(h1<h2) c1=null;
    if(h2<h1) c2=null;
  }

  const Tmax=Math.max((c1||0)*1.5,(c2||0)*1.5,864000);
  const d1=[],d2=[],dp=[];

  for(let i=0;i<600;i++){
    const t=i*Tmax/599;
    d1.push({x:t,y:Math.max(0,t-r1)});
    if(h2) d2.push({x:t,y:Math.max(0,t-r2)});
    dp.push({x:t,y:t*factor});
  }

  if(chart) chart.destroy();
  chart=new Chart($('chart'),{
    type:'line',
    data:{datasets:[
      {label:'Setup 1',data:d1,borderColor:'#f59e0b',pointRadius:0},
      h2&&{label:'Setup 2',data:d2,borderColor:'#60a5fa',pointRadius:0},
      {label:`Percent (${ph})`,data:dp,borderColor:'#4ade80',borderDash:[6,4],pointRadius:0}
    ].filter(Boolean)},
    options:{responsive:true,maintainAspectRatio:false,animation:false,
      scales:{
        x:{type:'linear',ticks:{callback:v=>Math.round(v/3600)+'h'}},
        y:{ticks:{callback:v=>Math.round(v/3600)+'h'}}
      }}
  );
}

$('enable2').addEventListener('change',draw);
document.querySelectorAll('input').forEach(i=>i.addEventListener('input',draw));
draw();
</script>
</body>
</html>
